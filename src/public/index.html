<html ng-app="slovicka">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.10/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.10/angular-route.min.js"></script>

    <script>
        console.debug("script");

        var app = angular.module("slovicka", ['ngRoute']);

        app.config(["$routeProvider", function($routeProvider) {

            console.debug("config of routeProvider", $routeProvider, this);

            $routeProvider
                .when('/login', {
                  controller: 'LoginController',
                  templateUrl: '/views/login.html'
                })
                .otherwise({
                  controller: 'TranslateController',
                  templateUrl: "/views/main.html"
                });

        }]);

        app.run(['$rootScope', '$location',
          function($rootScope, $location) {
            // see what's going on when the route tries to change
            $rootScope.$on('$routeChangeSuccess', function(event, next, current) {
              // next is an object that is the route that we are starting to go to
              // current is an object that is the route where we are currently
              console.log("current path:", $location.path());
              var currentPath = $location.path();
              var pattern = /.*access_token=(.*?)\&/i
              var accessTokenMatcher = pattern.exec(currentPath);
              console.log(accessTokenMatcher)
              if (accessTokenMatcher.length > 0) {  // it matches
                  var accessToken = accessTokenMatcher[1];
              }

              $rootScope.accessToken = accessToken;

              $rootScope.$broadcast('loginSuccessful', "login vole");

            });
          }
        ]);

        app.factory("myInterceptor", ["$log", function($log) {
            $log.debug("log from regresp responseInterceptor");

            return {
                request: function(request) {
                    $log.debug("request is ($@@#@): ", request);
                    return request;
                },
                response: function(response) {
                    $log.debug("response is ($@@#@): ", response);
                    return response;
                },
                requestError: function(error) {
                    $log.debug("request error is: ($@@#@): ", error);
                },
                responseError: function(error) {
                    $log.debug("request error is: ($@@#@): ", error);
                }
            }
        }]);

        app.config(["$httpProvider", function($httpProvider) {
            console.debug("config of httpProvider", this);
            $httpProvider.interceptors.push('myInterceptor');
        }]);

        console.debug("script end");

    </script>

    <script src="/controllers/LoginController.js"></script>
    <script src="/controllers/TranslateController.js"></script>
    <script src="/controllers/HeaderController.js"></script>
</head>

<body ng-app>

    <div id="content">

        <div id="header" ng-controller="HeaderController">
            <span>Username: {{userName}}</span>
            <div>Access Token: {{(accessToken) || "n/a"}}</div>
            <a href="#/login">Login</a>
        </div>

        <div ng-view>content here</div>

    </div>

</body>

</html>
